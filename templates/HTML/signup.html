{% extends "HTML/base.html" %}

{% block title %}회원가입{% endblock %}

{% block content %}

<h2>회원가입</h2>

{% if error %}
    <p style="color:red;">{{ error }}</p>
{% endif %}

<form method="POST">
    {% csrf_token %}

    <label for="username">아이디:</label>
    <input type="text" name="username" id="username" required>

    <button type="button" onclick="checkUsername()">중복 확인</button>
    <span id="username_check"></span>
    <br><br>

    <label for="password">비밀번호:</label>
    <input type="password" name="password" id="password" required>
    <br><br>

    <label for="phone">전화번호:</label>
    <input type="text" name="phone" id="phone" required>
    <br><br>

    <button type="submit">회원가입</button>
</form>

<script>
function checkUsername() {
    const username = document.getElementById("username").value;
    const result = document.getElementById("username_check");

    if (username.trim() === "") {
        result.innerText = "아이디를 입력해주세요.";
        result.style.color = "orange";
        return;
    }

    fetch(`/check-username/?username=${username}`)
        .then(response => response.json())
        .then(data => {
            if (data.exists) {
                result.innerText = "이미 존재하는 아이디입니다 ❌";
                result.style.color = "red";
            } else {
                result.innerText = "사용 가능한 아이디입니다 ✅";
                result.style.color = "green";
            }
        })
        .catch(error => {
            console.error("Error:", error);
            result.innerText = "서버 오류가 발생했습니다.";
            result.style.color = "red";
        });
}
</script>

{% endblock %}